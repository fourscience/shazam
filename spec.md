## Plugin API

- `irSchemaVersion`: `1.0.0`
- Lifecycle:
  1. **onDocument**: After IR is built, before any emit. Read-only IR; use for analytics or preparation.
  2. **onLibrary**: Before each library is written. Allowed: add imports/declarations/annotations; avoid mutating existing declarations or IR.
  3. **onRenderComplete**: After files written. Allowed: emit extra files under `RenderContext.outputRoot`, cleanup/logging.
- Allowed mutations:
  - Add imports, extensions, helper functions/classes to `LibraryBuilder`.
  - Write additional files alongside generated outputs in `outputRoot`.
- Forbidden:
  - Mutating IR (adding/removing fields, enums, records) to keep plugin ecosystem stable.
  - Removing generated declarations.

### Examples

**Banner plugin**
```dart
class BannerPlugin implements GeneratorPlugin {
  @override
  void onLibrary(LibraryBuilder library, DocumentIr ir, RenderContext ctx) {
    library.body.insert(0, Code('// Generated by BannerPlugin'));
  }
}
```

**Extra file emission**
```dart
class ChangelogPlugin implements GeneratorPlugin {
  @override
  void onRenderComplete(DocumentIr ir, RenderContext ctx) {
    final file = File(p.join(ctx.outputRoot, 'changelog.txt'));
    file.writeAsStringSync('Generated ${ir.operations.length} operations');
  }
}
```
